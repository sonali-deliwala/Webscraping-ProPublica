from bs4 import BeautifulSoup
from bs4 import SoupStrainer

import xmltodict
import xlsxwriter 

import xlrd

# import openpyxl module 
import openpyxl
from openpyxl import load_workbook

import requests
import re



eins = ['010215911', '010276272', '010284446', '010370309', '010372148', '010378758', '030179404', '042024022', '042103542', '042103550', '042104144', '042125005', '042197449', '042429311', '042814018', '043377720', '046074663', '046113618', '050351121', '060646702', '060646960', '060653119', '060677159', '060733693', '061051768', '061423598', '066002281', '112626155', '131623850', '131624048', '131635293', '131878953', '131974191', '133004747', '133913393', '133978518', '134043587', '136165593', '141501404', '141715960', '146022764', '160759798', '161025787', '161043694', '200097189', '200253310', '221487252', '221487307', '221720078', '222083588', '222367416', '223331880', '231352354', '231496890', '232048152', '232220051', '232657495', '232703530', '236437695', '237062502', '237066616', '237099149', '237161473', '237182582', '237267810', '237314364', '237373091', '237398279', '237410494', '237413415', '240772407', '250585280', '250979346', '250986051', '251340370', '251371578', '300406260', '311333812', '311551871', '311680916', '311688648', '330061828', '330828761', '330898712', '340714426', '340714670', '341314846', '341372076', '341522484', '341611055', '341839195', '341908579', '346007227', '350985964', '351362157', '351898055', '361892375', '362170786', '363535053', '366008929', '366108515', '370673513', '371079626', '371179056', '381359513', '381398840', '381405282', '381459365', '382394044', '382476777', '382709547', '386094484', '390806395', '391032051', '391157876', '391691578', '410695462', '410874507', '410946789', '411360294', '411390349', '411854826', '420680323', '420680372', '420843389', '420860039', '430653323', '430821959', '430899770', '431147836', '431209928', '431825029', '440552486', '450227391', '450333577', '450374475', '450505050', '460225483', '470595345', '470665946', '470708725', '510206092', '520686958', '521046302', '521268956', '521341314', '526001038', '530196544', '540505898', '540505989', '540721690', '541454861', '560562308', '560600035', '560754599', '561902501', '561937368', '562150550', '570314364', '570324915', '581216007', '581753685', '581999717', '582207654', '586010529', '590624364', '591800721', '591830079', '591867557', '592301233', '592867652', '593472733', '610601267', '611198452', '611428443', '620123940', '620528217', '620598316', '620852815', '630329409', '630412843', '631236563', '650309138', '660177824', '660234885', '660235625', '680127677', '680201024', '680233573', '680422370', '710246213', '710876594', '716044543', '716194026', '721387424', '730579242', '730938096', '730977997', '741297211', '741312313', '742310549', '742557820', '751152657', '751709180', '752247092', '752559845', '752960314', '810600548', '840511458', '841168686', '841349017', '850164940', '850335085', '850448090', '860283924', '860820600', '886003042', '910975541', '911327775', '911493474', '911522679', '911643930', '920037099', '920039344', '920041461', '931139187', '941156295', '941196211', '941337638', '941450151', '941719894', '942690415', '943120807', '943232900', '951426236', '951656369', '951691301', '951962659', '952504044', '952742514', '953042028', '953711613', '953886483', '954487850', '956100417', '956137481', '980041019', '980055968', '980078729', '990073488']

#eins = [ "010372148", "133978518", "381405282", "450374475", "470665946", "660235625", "920037099", "941719894", "942690415", "980078729"]

eins_batch_2_for2011 = [ '741297211', '741312313', '742310549', '742557820', '751152657', '751709180', '752247092', '752559845', '752960314', '810600548', '840511458', '841168686', '841349017', '850164940', '850335085', '850448090', '860283924', '860820600', '886003042', '910975541', '911327775', '911493474', '911522679', '911643930', '920037099', '920039344', '920041461', '931139187', '941156295', '941196211', '941337638', '941450151', '941719894', '942690415', '943120807', '943232900', '951426236', '951656369', '951691301', '951962659', '952504044', '952742514', '953042028', '953711613', '953886483', '954487850', '956100417', '956137481', '980041019', '980055968', '980078729', '990073488']

tot_rev_cy_2009 = ['110673680', '642968', '69928031', '4568988', '209048486', '12386189', '14065438', '1774178', '244624704', '73377350', '17838185', '219758', '100118978', '23466558', '10255308', '427569', '-39593', '368908', '8470386', '14543484', '25684402', '45824916', '9976261', '26232445', '569700', '523195', '3390363', '227517920', '6744973', '14621910', '49185151', '13395168', '616181002', '72382451', '4042072', '19326854', '9733455', '1012853', '3763555', '894966', '518872', '52615059', '4775033', '874993', '910995', '2963983', '20134383', '587190505', '3090218', '3074766', '2100610', '11375792', '68870284', '14324982', '825270', '16503559', '4222351', '1140249', '50101671', '1349282', '6022519', '19748326', '6235132', '31284941', '3867222', '26347843', '15100804', '1274554', '1542942', '368978', '216424449', '71560636', '70183022', '25680247', '45097649', '420876', '1701693', '756807', '23396743', '1691967', '1459901', '28726165', '6699015', '17211265', '26753945', '52210140', '918815', '426286', '3365102', '10973997', '29206884', '-5821733', '2610078', '143685987', '13159319', '4825866', '895625185', '34321066', '2185376', '63483356', '10051341', '69320751', '32431836', '13836235', '44397618', '1165272', '8927540', '28830920', '14802368', '-254741', '587629', '566733', '122957032', '1164540', '93012771', '5266542', '14464016', '9438337', '9115308', '2230912', '4993260', '349930', '60984987', '64203531', '15248088', '25398129', '1679074', '25409788', '543425', '11340720', '11717398', '8370214', '8462405', '8324120', '452252', '555733', '2065995', '88342892', '19080747', '21102294', '17413611', '751695', '5789929', '1594732', '1174420', '457543', '7458885', '9594639', '11788357', '322742020', '120119321', '3476964', '25638355', '5927824', '23264193', '67807099', '361238', '2261196', '12592012', '34788484', '45889155', '300874', '164432', '5566333', '13088469', '151257499', '38486225', '1292251', '256934515', '46014204', '29034936', '26952300', '19174977', '770490', '11282559', '650888006', '19384134', '31000656', '9424146', '46346676', '15444175', '1837427', '233079', '66500831', '3219570', '5907063', '52351757', '23420304', '6457729', '3537924', '19102834', '14679936', '18140304', '10419897', '2264943', '7365271', '1395045', '27620503', '3700511', '6847901', '15727531', '94709058', '4144492', '269046', '8379926', '220518979', '181934', '14758152', '10177233', '1034007', '23573962', '10487471', '4473749', '233932', '2900021', '1072617', '2399509', '5943452', '2107513', '2219382', '5654836', '1457598', '34615095', '2265488', '90491015', '14870413', '195479759', '51721424', '79159044', '195028979', '145540880', '77166297', '213292002', '40609', '34121577', '4193158', '12359412', '1425692', '48678317', '2046348', '578145', '600983', '906780', '13344008', '390558', '2576321', '40777602', '113254072', '51662705', '2094312']

#tot_rev_cy_2009 = [ 209048486 ,  53516923 ,  8927540 ,  555733 ,  21102294 ,  5907063 ,  34615095 ,  145540880 ,  77166297 ,  51662705 ]


tot_rev_cy_2010 = ['122900842', '509721', '72414792', '4496356', '216648084', '12994317', '16631751', '2387504', '280327817', '80659639', '20294317', '252705', '104697677', '25543661', '6473357', '452419', '555469', '502177', '8209633', '13880130', '23186005', '42968171', '9757334', '27613779', '534132', '521701', '2505898', '198407862', '10105487', '15362694', '49780019', '14141934', '627468115', '42538653', '4020269', '23131766', '9635517', '1016420', '3791222', '729935', '609121', '56731755', '5059682', '977840', '1934659', '4761721', '22030891', '622284006', '3037745', '3394323', '2087440', '11748529', '74151095', '12404914', '1776686', '9362560', '4708362', '1027474', '47460681', '1308656', '5666237', '25098624', '6496724', '36307108', '4866818', '28741854', '12434193', '1531969', '1704309', '592631', '233003584', '77455262', '67450652', '27295970', '47644475', '94914', '1577050', '565971', '24518142', '3131031', '1510696', '28803227', '11391916', '14667240', '30623642', '61405889', '734365', '1258198', '3371729', '2023911', '28497239', '20700819', '2463777', '151620205', '11042289', '7404649', '1046518213', '37520308', '2445761', '55903106', '11987142', '71635606', '33470296', '16026179', '58958407', '995715', '6540403', '28293560', '17035368', '723109', '571762', '578043', '133572374', '1337397', '100509661', '7017272', '21139960', '8644405', '9102678', '2628805', '5149542', '334858', '59171945', '81334145', '16074646', '25487482', '1555539', '26824045', '696564', '11044486', '14288467', '8579359', '7952959', '8747283', '446877', '423308', '2650200', '103184908', '23649189', '21578804', '14178428', '822766', '6212598', '1682506', '1216594', '568755', '9871808', '6578194', '13477411', '371363797', '139743718', '4577151', '30694112', '5964057', '24264719', '74026588', '472306', '2647075', '12534769', '33552070', '50093040', '264808', '330215', '8754317', '12738771', '203966134', '38871229', '1307898', '260779690', '45906651', '28156229', '29128658', '21458951', '917806', '12280315', '642632933', '20096803', '57651508', '10074089', '51719934', '15553059', '1722550', '215029', '70874236', '3252918', '6455871', '53341450', '24779146', '3519407', '3751043', '19017078', '16700384', '19082363', '132861', '781829', '5904964', '1192474', '32738821', '4413135', '7135707', '17350067', '99348830', '4436861', '4822373', '6154186', '232642459', '421147', '14312353', '12190802', '909327', '23292010', '8579119', '3034703', '246361', '2851890', '1050079', '3908584', '6229523', '3223987', '2218364', '5329986', '1174492', '38171806', '2183855', '92490609', '18220971', '224306765', '22128070', '88593070', '207236730', '148235603', '93545410', '239233217', '77070', '36745624', '2046200', '13200108', '1815028', '88139215', '2178015', '585298', '956353', '682725', '19630996', '800647', '2749242', '39530478', '27275532', '54149051', '1505074']

tot_rev_cy_2011 = ['126160636', '430058', '73602550', '5806251', '217882913', '14750944', '16465207', '1798227', '325110846', '97219404', '19190201', '330027', '107920617', '26108814', '3766255', '487517', '847541', '287176', '6985866', '13875156', '40700270', '36316665', '9228002', '27237761', '521451', '546703', '3016157', '206522629', '7057143', '14466797', '50778075', '16208495', '579258360', '59724538', '4300830', '22186860', '14545779', '959183', '3410088', '729657', '610308', '62148128', '5777984', '934105', '3954108', '5198829', '21245593', '624131028', '2832096', '3428107', '2726075', '10649725', '75131609', '13196883', '1687331', '17257138', '4339705', '1342638', '46059756', '1336137', '7609297', '23025607', '6477562', '37522603', '9381474', '34450300', '13085470', '1463250', '1718959', '1065174', '248338908', '80772707', '64184272', '24600962', '48343691', '94665', '1587371', '1394071', '25137927', '4066368', '1522238', '28677188', '11052908', '43148413', '23807244', '50346723', '647721', '1985384', '3642294', '4413125', '31750872', '52628401', '2463176', '164483382', '10865845', '8556775', '2077027269', '40024514', '2576804', '54279633', '6230236', '73639199', '34008361', '13206310', '33364638', '1150140', '13702248', '28510311', '33482440', '889694', '425347', '615685', '134171848', '1395670', '105529940', '3555917', '16753165', '7591361', '9248838', '4072487', '4986978', '273951', '54573305', '63688131', '17302414', '28474178', '1489689', '37951528', '4048260', '11447071', '12409262', '8456421', '8937337', '9241715', '480687', '488219', '3547077', '110795792', '7214153', '22690530', '13662312', '798351', '11685838', '1824976', '1263037', '305931', '14646736', '4547004', '16108179', '394261707', '113949408', '5103149', '27585404', '6244494', '24629600', '76896566', '436746', '6536272', '12492864', '31493072', '53123142', '195327', '346623', '6626112', '12321549', '212191047', '39226638', '1313382', '259429185', '49654287', '28271975', '30874280', '20101901', '734170', '13598777', '717794912', '19769904', '30084025', '9926689', '54191382', '18278834', '1756235', '195052', '73133479', '3369820', '8835935', '51723634', '25835715', '11618634', '4674841', '27793312', '18041816', '19022520', '3035223', '981229', '6435788', '1088100', '34973091', '4340713', '6319302', '18316814', '90693481', '4041878', '2707146', '5843642', '236066018', '462128', '13632487', '11782433', '1039881', '23481256', '10183899', '2423165', '180320', '2837545', '1294335', '6273326', '5920125', '3277377', '2795122', '5804912', '1260444', '43053727', '2589747', '86754784', '23838456', '234205255', '25686507', '90303379', '222677052', '140559402', '102963440', '243451999', '3307419', '37387292', '1074269', '15168717', '2612126', '98783410', '2242322', '632381', '648762', '661466', '12245990', '430732', '2294636', '55159657', '50321151', '57686885', '1877263']

total_2011_batch2 = [ '4340713', '6319302', '18316814', '90693481', '4041878', '2707146', '5843642', '236066018', '462128', '13632487', '11782433', '1039881', '23481256', '10183899', '2423165', '180320', '2837545', '1294335', '6273326', '5920125', '3277377', '2795122', '5804912', '1260444', '43053727', '2589747', '86754784', '23838456', '234205255', '25686507', '90303379', '222677052', '140559402', '102963440', '243451999', '3307419', '37387292', '1074269', '15168717', '2612126', '98783410', '2242322', '632381', '648762', '661466', '12245990', '430732', '2294636', '55159657', '50321151', '57686885', '1877263']

tot_rev_cy_2012 = ['136494576', '323359', '78963358', '5979592', '222546799', '14613790', '14925860', '2447130', '356118724', '98057222', '18299522', '296633', '99763852', '27752895', '2838718', '424492', '870339', '1469830', '6607348', '14941259', '24368847', '43301645', '10918403', '33997334', '456147', '554103', '1978330', '183189420', '6855584', '18249706', '52398185', '17369390', '606996477', '40285288', '4888724', '23803439', '10878204', '1042270', '3207779', '362320', '812745', '66627739', '6698961', '1094360', '9046361', '9398261', '22864953', '661418701', '2617587', '3768747', '3190829', '10462684', '77598651', '14525244', '1417500', '15640045', '4564719', '1281124', '45289276', '1341027', '8912295', '26140458', '6490846', '34137504', '8324251', '37910321', '13360020', '1479065', '1629208', '984431', '251153748', '77589321', '52707684', '25182320', '47569636', '66520', '1551170', '2397619', '24575773', '3199640', '1593978', '27359517', '10983193', '10219009', '31718418', '56529823', '748710', '1765098', '3429412', '15078111', '35343319', '85628334', '3104402', '169929334', '11730988', '9411059', '17210587', '42249472', '2805747', '60743107', '5496331', '85681509', '33415907', '28476776', '57340312', '812938', '11181573', '28969843', '20017249', '1434125', '499936', '635699', '129493990', '1807946', '103952476', '5817399', '16178184', '6888997', '9102424', '3000917', '5072534', '324226', '77156234', '62103019', '17480151', '30888450', '1675085', '36386095', '1666749', '11439261', '14927515', '8905976', '8748292', '9646598', '655711', '598286', '3906236', '110736920', '22024533', '23560976', '12984071', '635472', '7866516', '1869472', '1262298', '643808', '8449147', '3913595', '13872928', '406257078', '137882726', '4258198', '26666432', '5955573', '24491389', '83581105', '505328', '6254893', '16630951', '32955909', '57816038', '329485', '308858', '15978800', '13677068', '223048436', '41185145', '1329521', '259390946', '47679390', '23930015', '30705186', '19832435', '1042182', '13528231', '713609559', '17649495', '37738680', '10920335', '53674498', '18153506', '1565631', '153352', '76044978', '3397046', '10176570', '55996867', '25977580', '13564135', '5485862', '20791522', '20152700', '20282431', '1035542', '1005072', '5970387', '1108049', '31694301', '3593057', '5882751', '17929886', '114638876', '5030023', '4414651', '6053993', '282845153', '429282', '13977545', '10843235', '1136336', '24519506', '10623468', '3581780', '455297', '2979269', '1387660', '4691305', '6617576', '3199810', '2765753', '6484893', '1792656', '50835652', '2791620', '80973743', '22174334', '222422359', '27070357', '71186034', '222797915', '149419284', '113373196', '218924254', '91267', '41235644', '2363226', '17134503', '1848860', '135119496', '2256111', '661604', '754133', '1569228', '13155128', '419059', '2414417', '55329419', '124605223', '57853984', '1980780']

tot_rev_cy_2013 = ['147444854', '451200', '81089005', '6418238', '237325771', '19121874', '16312508', '4869429', '375381465', '100653882', '18655503', '1081152', '99673988', '29450780', '2661712', '550451', '1256538', '222580', '6767452', '15250685', '24579996', '50947712', '10762418', '32252008', '516077', '698179', '3354525', '174759706', '9975029', '15519995', '55091496', '17735493', '631049304', '38943816', '4528753', '28525784', '12423050', '1169553', '3196255', '720815', '691137', '71104111', '7605911', '1234349', '13493744', '10139454', '23388794', '663253034', '3004249', '3913143', '3424137', '11074499', '88033092', '9872533', '1396285', '20542094', '4761743', '1430663', '40902914', '1309481', '10206669', '25649926', '6691459', '32966905', '4213586', '37175065', '14126546', '2198664', '1468902', '1192544', '256785507', '75854556', '42992016', '24316330', '47666978', '89434', '1648036', '806925', '25307775', '5064258', '1586902', '35233217', '10941332', '21494184', '28189567', '58869414', '896429', '1422234', '3554689', '5710945', '25244883', '18190308', '3799316', '191109000', '11774229', '9365511', '16907419', '44376054', '2652865', '90532766', '5380540', '93552771', '33084921', '16594465', '53023137', '855975', '12846129', '33491747', '23665325', '1066432', '512148', '666936', '136936736', '2207504', '111290605', '7130394', '18540059', '7223438', '9454487', '4202002', '5243276', '325447', '62528992', '68572391', '16940476', '30261080', '1499159', '35041879', '1872665', '12537013', '13887909', '9530420', '14718375', '9173023', '541028', '638982', '4286493', '117294629', '29063490', '28898918', '12243462', '685568', '16271695', '1907960', '1279904', '552136', '6926142', '4052783', '18179361', '460384288', '171941742', '4612153', '26552586', '5425311', '26670352', '90792988', '559502', '2381180', '15807699', '31753405', '60876816', '303807', '256164', '6005945', '12346109', '215658064', '41553469', '948530', '265248221', '47236170', '26657218', '31344718', '22512753', '911782', '12020294', '685584865', '18895482', '32499133', '10509303', '52612603', '19129774', '1201718', '157953', '77087689', '3521685', '5183126', '60839572', '29105363', '9019508', '3992515', '26050800', '17600032', '18561109', '1852776', '873680', '9285190', '1333765', '32970672', '4252525', '5831102', '19197126', '114312837', '4491369', '4408970', '5867310', '288445724', '560501', '19247644', '13821087', '1314308', '25494523', '12027771', '3789395', '155514', '3035155', '1490507', '5188076', '7353904', '3487622', '2854843', '6451795', '2038073', '54972418', '2393748', '111959996', '23162717', '210874182', '32633290', '66678048', '217614290', '157183976', '132777853', '197950374', '109717', '47375599', '2717938', '19881938', '1852306', '117175117', '2291195', '691558', '1976661', '2206248', '16260476', '397651', '3772826', '67242095', '177810670', '59810651', '1974475']

tot_rev_cy_2014 = ['166911061', '398922', '88764244', '7158666', '251737826', '18331815', '17728388', '3231095', '396785932', '106807329', '18884939', '1525612', '106520889', '30786399', '3526534', '533306', '1082695', '3373339', '7559630', '14251147', '34522108', '47629718', '10974019', '36072710', '649309', '757947', '2487722', '184701438', '8974106', '17225488', '55785531', '20947318', '680259090', '37422921', '4273737', '33283168', '31533905', '1128488', '3350260', '325966', '837474', '74661376', '7463200', '1533905', '19309416', '10304545', '30195083', '677137484', '2989974', '3747455', '3428871', '11775140', '86106352', '9808885', '1543375', '18696371', '4564064', '1523355', '41887235', '1375292', '12844786', '26683170', '6967965', '20096038', '4570161', '52959255', '14180617', '2965430', '1546531', '946559', '267244714', '66051909', '44028132', '24045418', '49242297', '119728', '1601085', '876618', '23824009', '3281018', '1587722', '27536347', '10878819', '8205670', '28666573', '51591946', '1005051', '1150167', '3524038', '3026583', '23164372', '9456826', '3233251', '198061057', '11763353', '8794508', '18196678', '46880836', '2847199', '85425939', '3961302', '92116143', '32714351', '15165740', '79243633', '1104832', '14149530', '31253257', '27094971', '971446', '490775', '662340', '132045126', '2255647', '106161399', '8186226', '17813558', '8549727', '11244876', '3758670', '5328664', '356098', '73185269', '76273426', '18075230', '31246337', '1532478', '37336093', '1978445', '12698812', '20771433', '9872989', '13092952', '10131256', '490125', '473444', '3704535', '122478804', '13035556', '31408452', '13275544', '657402', '8847635', '1991356', '1288864', '444302', '7375602', '4599204', '56106875', '477412397', '197168418', '5214338', '28459208', '5288467', '26595628', '104934980', '583349', '3299628', '17002959', '33335331', '63033279', '374347', '277996', '6461816', '13220792', '211919271', '43604779', '1373268', '291734864', '90271099', '28422473', '32770876', '22850652', '1309764', '13241591', '706338048', '17674242', '33757399', '11012404', '55770586', '19010717', '294143', '129790', '77699007', '3394782', '5669521', '66687698', '29004824', '9562033', '3786853', '31500738', '17709789', '17637410', '8327672', '834900', '5833602', '1337066', '33964047', '7838547', '6254082', '18711496', '140337450', '4554562', '4093131', '7337575', '320468956', '811466', '18109308', '11953134', '1167585', '28259587', '18322656', '3880343', '642369', '3290161', '1546103', '11120374', '7168562', '3939173', '2954621', '6505788', '1705805', '61294402', '3047217', '102156434', '26356574', '238494068', '31868698', '76157953', '242634371', '162944541', '146947928', '167470969', '152224', '50252502', '2920905', '19504364', '3700694', '113371008', '2435596', '725747', '595977', '1779492', '22800574', '433884', '2316268', '73515164', '111890868', '61187887', '2041793']

tot_rev_cy_2015 = ['190659711', '321793', '97503169', '7470291', '278270243', '19390193', '15656308', '3181827', '329573554', '84738790', '18995390', '1982519', '110973930', '31663105', '3508917', '346235', '719056', '3164141', '7672583', '13677944', '44606874', '46281851', '11096749', '36200199', '710833', '1545348', '3209349', '203162835', '9086793', '17818609', '55785292', '22639386', '701001252', '60014592', '4762667', '40420032', '19709765', '1268979', '3546379', '609393', '808891', '74285791', '7571405', '1602763', '19458887', '7073443', '28875690', '672424783', '3419783', '5099604', '3680880', '11972835', '91212398', '10258309', '1325839', '23817632', '3552989', '1385120', '41923269', '1398498', '8578456', '29055481', '7143820', '36611563', '3427861', '50892509', '13537620', '3090597', '1480344', '6381704', '261750893', '62913776', '43012266', '26143695', '48445675', '112269', '1800007', '1520342', '28003497', '-165984', '1580230', '26041099', '11602677', '9848663', '27705856', '47136490', '1108438', '1226190', '3864110', '10920069', '20134510', '10437949', '3342383', '209945833', '11972381', '8020267', '22649705', '50205024', '3104485', '70225003', '7439476', '85486520', '32673970', '14233837', '61610348', '1038847', '12984899', '35765475', '21853681', '862725', '409841', '762345', '134230652', '2105906', '106736768', '11330311', '18430551', '9108002', '11115393', '3917964', '6198810', '392717', '83728369', '73505221', '19394508', '30868619', '1678862', '40523654', '3752654', '11808063', '17046537', '9842574', '12164308', '10237234', '436419', '217166', '4300119', '124512856', '20880948', '28019184', '15632036', '545228', '3974994', '2179826', '1291606', '788523', '7072469', '5020803', '23451655', '478929698', '156278955', '5837879', '26235779', '5157570', '29429486', '114497846', '624024', '4122441', '18107555', '33974236', '66014894', '601200', '242935', '6958059', '13925759', '199529717', '48852804', '1361203', '298476784', '95801582', '29015669', '33202886', '22745125', '1164970', '11011628', '618796997', '30317648', '40580981', '10742437', '55904597', '19147808', '523381', '128654', '67522041', '3364080', '4509337', '64781167', '30870283', '20228983', '3496464', '45607888', '18428096', '18496246', '2462254', '2374390', '5954866', '1298395', '36521459', '5067635', '6182119', '18893487', '131420434', '4747664', '3747723', '9171088', '344679739', '583079', '19255671', '16134246', '1169537', '29450101', '13747397', '1554425', '765165', '3491173', '1682513', '9102428', '8241729', '3814800', '2843983', '6205717', '1858651', '66526394', '3815499', '106987887', '21551815', '233022467', '30330042', '75700835', '238883586', '177073446', '165241230', '177503583', '120422', '51603131', '3807109', '18536541', '2162507', '107187626', '2580250', '771583', '744235', '2448255', '30940751', '497908', '2872582', '68914497', '110441972', '63615221', '2456253']



book = openpyxl.load_workbook("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")
sheet = book["year12"]

ein_column = ""

revenue_column = ""

if_xml_column = ""

display_xml_column = ""

verify_here_column = ""

column_counter = 0

i=0

for ein in eins:
#year = 2009

	

	total_revenue = tot_rev_cy_2012[i]

	two_filings_found_for_year = False

	
	r = requests.get("https://projects.propublica.org/nonprofits/organizations/" + str(ein))
	soup = BeautifulSoup(r.text, 'html.parser')
	single_filings = soup.find_all('div', {'class' :'single-filing cf'})
	url_list = []
	for single in single_filings:
		a = single.find('a', {'class' :'action xml'})
		if a != None:
			url_list.append((a['href']))
		subject_options = [i.findAll('option') for i in single.findAll('select', attrs = {'class': 'action xml'} )]
	

		#print(subject_options)
		if subject_options != []:
			#import pdb; pdb.set_trace()
			soup2 = BeautifulSoup(str(subject_options[0][1]), 'html.parser')
			link2 = soup2.find("option")['data-href']
			soup3 = BeautifulSoup(str(subject_options[0][2]), 'html.parser')
			link3 = soup3.find("option")['data-href']

			load_first_xml = requests.get(link2)
			load_second_xml = requests.get(link3)

			first_xml_doc = BeautifulSoup(load_first_xml.text, 'html.parser')
			second_xml_doc = BeautifulSoup(load_second_xml.text, 'html.parser')


			tag1 = first_xml_doc.find(re.compile("cytotalrevenueamt"))
			tag2 = first_xml_doc.find(re.compile("totalrevenuecurrentyear"))
			tag3 = second_xml_doc.find(re.compile("cytotalrevenueamt"))
			tag4 = second_xml_doc.find(re.compile("totalrevenuecurrentyear"))

			if tag1!= None or tag2 != None or tag3 != None or tag4 != None:
				if tag1!= None:
					if str(total_revenue) == tag1.text:
						two_filings_found_for_year = True

						ein_column = "A" + str(column_counter + 2)
						sheet[ein_column] = ein

						revenue_column = "B" + str(column_counter + 2)
						sheet[revenue_column] = total_revenue

						if_xml_column = "C" + str(column_counter + 2)
						sheet[if_xml_column] = "2 filings "

						display_xml_column = "D" + str(column_counter + 2)
						sheet[display_xml_column] = "2 XMLs for this year "

						verify_here_column = "E" + str(column_counter + 2)
						sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)

						book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

				if tag2!= None:
					if str(total_revenue) == tag2.text:
						two_filings_found_for_year = True

						ein_column = "A" + str(column_counter + 2)
						sheet[ein_column] = ein

						revenue_column = "B" + str(column_counter + 2)
						sheet[revenue_column] = total_revenue

						if_xml_column = "C" + str(column_counter + 2)
						sheet[if_xml_column] = "2 filings "

						display_xml_column = "D" + str(column_counter + 2)
						sheet[display_xml_column] = "2 XMLs for this year "

						verify_here_column = "E" + str(column_counter + 2)
						sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)

						book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

				if tag3!= None:
					if str(total_revenue) == tag3.text:
						two_filings_found_for_year = True

						ein_column = "A" + str(column_counter + 2)
						sheet[ein_column] = ein

						revenue_column = "B" + str(column_counter + 2)
						sheet[revenue_column] = total_revenue

						if_xml_column = "C" + str(column_counter + 2)
						sheet[if_xml_column] = "2 filings "

						display_xml_column = "D" + str(column_counter + 2)
						sheet[display_xml_column] = "2 XMLs for this year "

						verify_here_column = "E" + str(column_counter + 2)
						sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)

						book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

				if tag4!= None:
					if str(total_revenue) == tag4.text:
						two_filings_found_for_year = True

						ein_column = "A" + str(column_counter + 2)
						sheet[ein_column] = ein

						revenue_column = "B" + str(column_counter + 2)
						sheet[revenue_column] = total_revenue

						if_xml_column = "C" + str(column_counter + 2)
						sheet[if_xml_column] = "2 filings "

						display_xml_column = "D" + str(column_counter + 2)
						sheet[display_xml_column] = "2 XMLs for this year "

						verify_here_column = "E" + str(column_counter + 2)
						sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)

						book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")


				column_counter +=1



	c = ""

	#finding the correct xml for the given year

	for element in url_list:
		x = requests.get(element)
		soup = BeautifulSoup(x.text, 'html.parser')

		y = soup.find(re.compile("cytotalrevenueamt"))
		z = soup.find(re.compile("totalrevenuecurrentyear"))

		if y!= None:
			if str(total_revenue) == y.text:
				c = element

				print(y.text)
				print("got the right xml: " + c)
				
				ein_column = "A" + str(column_counter + 2)
				sheet[ein_column] = ein

				revenue_column = "B" + str(column_counter + 2)
				sheet[revenue_column] = total_revenue

				if_xml_column = "C" + str(column_counter + 2)
				sheet[if_xml_column] = "Yes!"

				display_xml_column = "D" + str(column_counter + 2)
				sheet[display_xml_column] = c

				verify_here_column = "E" + str(column_counter + 2)
				sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)

				book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")


				column_counter +=1

				break
		if z!= None:
			if str(total_revenue) == z.text:

				c = element

				print(z.text)
				print("got the right xml: " + c)
				
				
				ein_column = "A" + str(column_counter + 2)
				sheet[ein_column] = ein

				revenue_column = "B" + str(column_counter + 2)
				sheet[revenue_column] = total_revenue

				if_xml_column = "C" + str(column_counter + 2)
				sheet[if_xml_column] = "Yes!"

				display_xml_column = "D" + str(column_counter + 2)
				sheet[display_xml_column] = c

				verify_here_column = "E" + str(column_counter + 2)
				sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)


				book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

				column_counter +=1

				break
		

	if c == "":

		if url_list == []:
			print("NO XMLS for this ein AT ALL!!")

			ein_column = "A" + str(column_counter + 2)
			sheet[ein_column] = ein

			revenue_column = "B" + str(column_counter + 2)
			sheet[revenue_column] = total_revenue

			if_xml_column = "C" + str(column_counter + 2)
			sheet[if_xml_column] = " no :( "

			display_xml_column = "D" + str(column_counter + 2)
			sheet[display_xml_column] = "NO XMLS for this ein AT ALL!!"

			verify_here_column = "E" + str(column_counter + 2)
			sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)


			book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

		else:

			if two_filings_found_for_year==False:

				print("no xml found for this year for ein " + str(ein) + " Try again!")

				print("Verify this at link" + "https://projects.propublica.org/nonprofits/organizations/" + str(ein))

				ein_column = "A" + str(column_counter + 2)
				sheet[ein_column] = ein

				revenue_column = "B" + str(column_counter + 2)
				sheet[revenue_column] = total_revenue

				if_xml_column = "C" + str(column_counter + 2)
				sheet[if_xml_column] = " no :( "

				display_xml_column = "D" + str(column_counter + 2)
				sheet[display_xml_column] = "no xml found for this ein"

				verify_here_column = "E" + str(column_counter + 2)
				sheet[verify_here_column] = "https://projects.propublica.org/nonprofits/organizations/" + str(ein)


				book.save("/Users/ssd/Downloads/ForSonali_XMLexistence_edited.xlsx")

		column_counter +=1




	i+=1


	
